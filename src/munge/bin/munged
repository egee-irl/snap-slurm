#!/bin/bash

set -e


# Check to see if we should even start
#snap_mode=$(cat $SNAP_COMMON/snap_mode)
#if [[ $snap_mode = "all" ]]; then
#        exit 0
#fi


export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:$SNAP/lib/x86_64-linux-gnu/:$SNAP/lib/:$SNAP/usr/local/lib:$SNAP/usr/lib/x86_64-linux-gnu/:$SNAP/lib/slurm


exec "$SNAP/usr/local/sbin/munged" \
     "--key-file=$SNAP_COMMON/etc/munge/munge.key" \
     "--socket=/tmp/munged.socket.2" \
     "--pid-file=/tmp/munged.pid" \
     "--log-file=$SNAP_COMMON/var/log/munge/munged.log" \
     "--seed-file=$SNAP_COMMON/var/lib/munge/munge.seed" \
     "--num-threads=10" "--force" "--foreground" "--group-check-mtime=0" "$@"
